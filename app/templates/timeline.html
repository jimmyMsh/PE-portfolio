{% extends "base.html" %}

{% block title %}Timeline Posts{% endblock %}

{% block content %}
<section class="section">
    <h1 class="title">Create a timeline post</h1>

    <form id="timeline-form" method="POST" action="{{ url_for('timeline') }}">
        <div class="field">
            <label class="label">Name</label>
            <div class="control">
                <input class="input" type="text" name="name" placeholder="Your name" required>
            </div>
        </div>

        <div class="field">
            <label class="label">Email</label>
            <div class="control has-icons-left has-icons-right">
                <input class="input" type="email" name="email" placeholder="Your email" required>
                <span class="icon is-small is-left">
                    <i class="fas fa-envelope"></i>
                </span>
            </div>
        </div>

        <div class="field">
            <label class="label">Content</label>
            <div class="control">
                <textarea class="textarea" name="content" placeholder="Your message" required></textarea>
            </div>
        </div>

        <div class="field is-grouped">
            <div class="control">
                <button class="button is-link" type="submit">Submit</button>
            </div>
            <div class="control">
                <button class="button is-link is-light" type="reset">Cancel</button>
            </div>
        </div>
    </form>

    <div id="posts" class="section">
        {% for post in timeline_posts %}
        <div class="box">
            <article class="media">
                <div class="media-left">
                    <figure class="image is-48x48">
                        <img src="https://www.gravatar.com/avatar/{{ post.email | to_md5 }}?s=48&d=identicon" alt="Profile image">
                    </figure>
                </div>
                <div class="media-content">
                    <div class="content">
                        <p>
                            <strong>{{ post.name }}</strong> <small>{{ post.email }}</small> <br>
                            {{ post.content }}
                        </p>
                    </div>
                </div>
                <div class="media-right">
                    <small class="post-date" data-date="{{ post.created_at | format_datetime }}"></small>
                </div>
            </article>
        </div>
        {% endfor %}
    </div>
</section>

<script>
    document.getElementById('timeline-form').addEventListener('submit', function(event) {
        alert('Form submitted successfully! Redirecting...');
    });

    // Function to format dates
    function formatDates() {
        const dateElements = document.querySelectorAll('.post-date');
        dateElements.forEach(el => {
            const date = new Date(el.getAttribute('data-date'));
            el.textContent = date.toLocaleString();
        });
    }

    // Initial call to format existing dates
    formatDates();
</script>
{% endblock %}
